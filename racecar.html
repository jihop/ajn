<!doctype html>
<html>
	<head>
		<!-- Load the Paper.js library -->
		<script type="text/javascript" src="paper.js"></script>
		<!-- Define inlined PaperScript associate it with myCanvas -->
		<script type="text/paperscript" canvas="myCanvas">
			
			function createRoadLine(color) {
				// Create a Paper.js Path to draw a line into it:
				var path = new Path();
				// Give the stroke a color
				path.strokeColor = color;
				var start = new Point(100, 100);
				// Move to start and draw a line from there
				path.moveTo(start);
				// Note the plus operator on Point objects.
				// PaperScript does that for us, and much more!
				path.lineTo(start + [ 0, -50 ]);
				return path;
			}
			
			var numberOfLanes = 5;
			var numberOfLinesPerLane = 50;
			var line = createRoadLine("yellow");
			var symbol = new Symbol(line);
			
			for(var x = 0; x < numberOfLanes; x++) {
				for(var y = 0; y < numberOfLinesPerLane; y++) {
					//console.log('place a new line: ' + x * 100 + " " + y * -50);
					var position = new Point(x * 100, -(y * 50 + y * 100));
					//console.log(position);
					var placedLine = symbol.place(position);
				}
			}
			
			var time1;
			
			
			function onFrame(event) {
				if (!time1) {
					time1 = new Date().getTime();
				}
				var time2 = new Date().getTime();
				var delta = time2 - time1;
				time1 = time2;
				//console.log('delta: ' + delta);
				document.getElementById("fps").innerHTML = Math.ceil(1/(delta/1000));
				//console.log('on frame');
				for (var i = 0; i < numberOfLanes * numberOfLinesPerLane; i++) {
					var item = project.activeLayer.children[i];
					
					item.position.y += item.bounds.height / 2;
				}
			}
			
			var numberOfPlayers = 2;
			function createPlayerCar(x, y, color) {
				var racecar = new Rectangle(x, y, 100, 100);
				var path = new Path.Rectangle(racecar);
				
				path.fillColor = color;
				
				return path;
			}
			var player1 = createPlayerCar(100, 500, "green");
			var player2 = createPlayerCar(200, 500, "blue");
			//console.log(player1.position);
			
			function onKeyDown(e) {
				//console.log('key down: ' + e.key);
				switch(e.key) {
					case "left":
						// player2 goes left;
						var xPos = player2.position.getX() - 100;
						//console.log(xPos);
						player2.position.setX(xPos);
						break;
					case "right":
						// player2 goes right;
						var xPos = player2.position.getX() + 100;
						player2.position.setX(xPos);
						break;
					case "a":
						// player1 goes left;
						var xPos = player1.position.getX() - 100;
						player1.position.setX(xPos);
						break;
					case "d":
						// player1 goes right;
						var xPos = player1.position.getX() + 100;
						player1.position.setX(xPos);
						break;
				}
			}
		</script>
		<style>
			html, body {
				background: white;
				margin: 0;
				padding: 0;
			}
			#myCanvas {
				background: grey;
				margin: 20px;
			}
		</style>
	</head>
	<body>
		<p>fps: <span id="fps"></span></p>
		<canvas id="myCanvas" width="500" height="600"></canvas>
	</body>
</html